# 지수 평활법: 단순/이중/삼중 지수 평활, Holt-Winters, ETS

## 왜 지수 평활법을 배우는가

지수 평활법은 ARIMA와 함께 시계열 예측의 양대 축을 이루는 방법입니다. ARIMA가 자기상관 구조에 기반한 모델이라면, 지수 평활법은 최근 관측값에 더 큰 가중치를 부여하는 직관적인 접근입니다. 구현이 간단하고 해석이 쉬우며, 적절히 사용하면 ARIMA에 필적하는 예측 성능을 보여줍니다. 특히 ETS 프레임워크를 통해 통계적으로도 엄밀한 체계를 갖추고 있습니다.

---

## 1. 단순 지수 평활 (Simple Exponential Smoothing)

추세와 계절성이 없는 시계열에 적합합니다.

### 재귀 공식

$$\hat{Y}_{t+1} = \alpha Y_t + (1 - \alpha) \hat{Y}_t, \quad 0 < \alpha < 1$$

이를 전개하면 과거 관측값에 대한 기하급수적 가중 평균임을 알 수 있습니다.

$$\hat{Y}_{t+1} = \alpha \sum_{j=0}^{t-1} (1-\alpha)^j Y_{t-j} + (1-\alpha)^t \ell_0$$

| $\alpha$ 값 | 특성 | 적합한 경우 |
|------------|------|-----------|
| $\alpha \to 1$ | 최근 값에 집중 | 변동이 큰 시계열 |
| $\alpha \to 0$ | 과거 값을 오래 기억 | 안정적 시계열 |
| $\alpha = 0.2$ | 일반적 시작점 | 탐색적 분석 |

> **핵심 직관**: 지수 평활은 "최근 것을 더 믿고, 오래된 것은 잊되, 완전히 버리지는 않는다"는 원리입니다.

```python
from statsmodels.tsa.holtwinters import SimpleExpSmoothing

model = SimpleExpSmoothing(ts).fit(smoothing_level=0.2, optimized=False)
forecast = model.forecast(steps=12)
```

---

## 2. 이중 지수 평활 (Holt의 선형 추세법)

선형 추세가 있는 시계열에 적합합니다. **수준(level)**과 **추세(trend)** 두 개의 상태를 추적합니다.

### 재귀 공식

$$\ell_t = \alpha Y_t + (1 - \alpha)(\ell_{t-1} + b_{t-1})$$

$$b_t = \beta^*(\ell_t - \ell_{t-1}) + (1 - \beta^*) b_{t-1}$$

$$\hat{Y}_{t+h} = \ell_t + h \cdot b_t$$

| 파라미터 | 의미 | 범위 |
|---------|------|------|
| $\alpha$ | 수준 평활 계수 | $(0, 1)$ |
| $\beta^*$ | 추세 평활 계수 | $(0, 1)$ |

### 감쇠 추세 (Damped Trend)

장기 예측에서 추세가 무한히 계속되는 것은 비현실적이므로, 감쇠 파라미터 $\phi$를 도입합니다.

$$\hat{Y}_{t+h} = \ell_t + (\phi + \phi^2 + \cdots + \phi^h) b_t$$

$0 < \phi < 1$이면 추세가 점차 약해져 수평에 수렴합니다.

> **핵심 직관**: 감쇠 추세는 "추세는 영원하지 않다"는 현실을 반영하며, 장기 예측에서 거의 항상 더 좋은 성능을 보입니다.

```python
from statsmodels.tsa.holtwinters import Holt

# 감쇠 추세 모델
model = Holt(ts, damped_trend=True).fit()
forecast = model.forecast(steps=24)
```

---

## 3. 삼중 지수 평활 (Holt-Winters)

추세와 계절성이 모두 있는 시계열에 적합합니다. **수준**, **추세**, **계절성** 세 개의 상태를 추적합니다.

### 3.1 가법 계절 모델

$$\ell_t = \alpha(Y_t - S_{t-s}) + (1-\alpha)(\ell_{t-1} + b_{t-1})$$

$$b_t = \beta^*(\ell_t - \ell_{t-1}) + (1-\beta^*) b_{t-1}$$

$$S_t = \gamma(Y_t - \ell_{t-1} - b_{t-1}) + (1-\gamma) S_{t-s}$$

$$\hat{Y}_{t+h} = \ell_t + h \cdot b_t + S_{t+h-s}$$

### 3.2 승법 계절 모델

$$\ell_t = \alpha \frac{Y_t}{S_{t-s}} + (1-\alpha)(\ell_{t-1} + b_{t-1})$$

$$S_t = \gamma \frac{Y_t}{\ell_{t-1} + b_{t-1}} + (1-\gamma) S_{t-s}$$

$$\hat{Y}_{t+h} = (\ell_t + h \cdot b_t) \cdot S_{t+h-s}$$

| 구분 | 가법 모델 | 승법 모델 |
|------|---------|---------|
| 계절 변동 | 절대 크기 일정 | 수준에 비례 |
| 수식 | $Y = \ell + b + S$ | $Y = (\ell + b) \times S$ |
| 적합 데이터 | 변동 폭 일정 | 변동 폭 증가 |
| 예시 | 기온 변화 | 항공 승객 수 |

> **핵심 직관**: ts-01에서 배운 시계열 분해와 같은 원리이며, Holt-Winters는 이를 **예측 가능한 모델**로 만듭니다.

```python
from statsmodels.tsa.holtwinters import ExponentialSmoothing

model = ExponentialSmoothing(
    ts_monthly,
    trend='add',
    seasonal='mul',
    seasonal_periods=12,
    damped_trend=True
).fit()
forecast = model.forecast(steps=24)
```

---

## 4. ETS 프레임워크

ETS(Error, Trend, Seasonal)는 지수 평활법에 통계적 모델 구조를 부여하는 프레임워크입니다.

### 4.1 구성 요소 분류

| 요소 | 옵션 | 기호 |
|------|------|------|
| Error (오차) | 가법(A), 승법(M) | E |
| Trend (추세) | 없음(N), 가법(A), 감쇠 가법(Ad) | T |
| Seasonal (계절) | 없음(N), 가법(A), 승법(M) | S |

### 4.2 ETS 모델 목록

총 $2 \times 3 \times 3 = 18$개 모델이 가능하지만, 실무에서 많이 사용되는 모델은 다음과 같습니다.

| ETS 모델 | 의미 | 대응하는 평활법 |
|---------|------|-------------|
| ETS(A,N,N) | 가법 오차, 추세/계절 없음 | 단순 지수 평활 |
| ETS(A,A,N) | 가법 오차, 가법 추세 | Holt의 선형법 |
| ETS(A,Ad,N) | 가법 오차, 감쇠 추세 | 감쇠 추세법 |
| ETS(A,A,A) | 모두 가법 | Holt-Winters 가법 |
| ETS(M,A,M) | 승법 오차, 가법 추세, 승법 계절 | Holt-Winters 승법 |

### 4.3 상태 공간 표현

ETS(A,A,N)의 상태 공간 형태:

$$Y_t = \ell_{t-1} + b_{t-1} + \epsilon_t$$

$$\ell_t = \ell_{t-1} + b_{t-1} + \alpha \epsilon_t$$

$$b_t = b_{t-1} + \beta \epsilon_t$$

이 표현은 ts-05에서 다룰 상태 공간 모델과 직접 연결됩니다.

> **핵심 직관**: ETS는 지수 평활법에 **확률 모델 구조**를 부여하여, 우도 계산과 예측 구간 산출을 가능하게 합니다.

```python
from statsmodels.tsa.holtwinters import ExponentialSmoothing

# ETS 자동 선택 (statsmodels의 ETSModel 사용)
from statsmodels.tsa.exponential_smoothing.ets import ETSModel

model = ETSModel(ts_monthly,
                 error='add',
                 trend='add',
                 seasonal='mul',
                 damped_trend=True,
                 seasonal_periods=12).fit()
print(f'AIC: {model.aic:.2f}')
```

---

## 5. ARIMA vs. 지수 평활법 비교

| 비교 항목 | ARIMA | 지수 평활 (ETS) |
|----------|-------|---------------|
| 기반 | 자기상관 구조 | 가중 평균 |
| 추세 처리 | 차분 | 상태 변수 |
| 계절성 | SARIMA | Holt-Winters |
| 해석 | 이론적 | 직관적 |
| 예측 구간 | 해석적 | 상태 공간 기반 |
| 동치 관계 | ARIMA(0,1,1) | ETS(A,N,N), $\theta = 1-\alpha$ |

> **핵심 직관**: ARIMA(0,1,1)과 ETS(A,N,N)은 수학적으로 **동치**입니다. 두 프레임워크는 서로 다른 관점에서 같은 현상을 설명합니다.

---

## 6. 파라미터 최적화와 실무 팁

### 6.1 최적화 방법

ETS 파라미터는 MLE(si-02 참조)로 추정합니다. 로그 우도 함수:

$$\ln L = -\frac{T}{2} \ln(2\pi\sigma^2) - \frac{1}{2\sigma^2} \sum_{t=1}^{T} \epsilon_t^2$$

### 6.2 실무 팁

| 상황 | 권장 모델 | 이유 |
|------|---------|------|
| 추세도 계절성도 없음 | ETS(A,N,N) | 가장 단순 |
| 추세만 있음 | ETS(A,Ad,N) | 감쇠 추세 기본 |
| 추세 + 계절 | ETS(M,Ad,M) | 실무에서 가장 일반적 |
| 짧은 시계열 ($T < 2s$) | 계절 성분 없이 | 계절 파라미터 추정 불가 |

```python
# 여러 ETS 모델 비교
from statsmodels.tsa.exponential_smoothing.ets import ETSModel

configs = [
    ('add', 'add', 'add'),
    ('add', 'add', 'mul'),
    ('mul', 'add', 'mul'),
]
for error, trend, seasonal in configs:
    try:
        m = ETSModel(ts_monthly, error=error, trend=trend,
                     seasonal=seasonal, seasonal_periods=12).fit()
        print(f'ETS({error},{trend},{seasonal}): AIC={m.aic:.1f}')
    except:
        continue
```

> **핵심 직관**: 의심스러우면 **감쇠 추세**를 선택하십시오. M3/M4 예측 대회에서 감쇠 추세 모델이 일관되게 좋은 성능을 보였습니다.

---

## 핵심 정리

- **단순 지수 평활은 최근 값에 더 큰 가중치를 부여하는 가중 평균으로, 추세와 계절성이 없을 때 적합합니다.**
- **Holt의 이중 지수 평활은 수준과 추세를 동시에 추적하며, 감쇠 추세를 추가하면 장기 예측이 안정됩니다.**
- **Holt-Winters(삼중 지수 평활)는 수준·추세·계절성을 모두 모델링하며, 가법과 승법 계절 모델을 선택할 수 있습니다.**
- **ETS 프레임워크는 지수 평활법에 오차·추세·계절의 18가지 조합으로 체계적 통계 모델 구조를 부여합니다.**
- **ARIMA(0,1,1)과 ETS(A,N,N)은 수학적으로 동치이며, 두 접근법은 상호 보완적으로 사용합니다.**
