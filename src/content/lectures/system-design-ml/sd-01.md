# ML 시스템 설계 프레임워크

## 왜 ML 시스템 설계 프레임워크가 중요한가

ML 시스템 설계 면접은 코딩 인터뷰와 근본적으로 다릅니다. 정답이 없는 개방형 문제에서 **체계적인 사고 과정**을 보여줘야 합니다. 프레임워크 없이 접근하면 중요한 구성 요소를 빠뜨리거나, 면접관이 원하는 깊이에 도달하지 못합니다.

> **핵심 직관**: ML 시스템 설계 면접은 "최적의 모델을 고르는 것"이 아니라 "모든 구성 요소를 고려하여 트레이드오프를 논의하는 과정"을 평가합니다.

## 1. 설계 면접의 구조

ML 시스템 설계 면접은 보통 45-60분이며, 다음과 같은 흐름으로 진행됩니다.

```
ML 시스템 설계 면접 흐름 (45분 기준):

  [0-5분]   문제 정의 & 요구사항 명확화
      │
  [5-10분]  메트릭 정의 (오프라인/온라인)
      │
  [10-20분] 시스템 아키텍처 설계
      │      ├─ 데이터 파이프라인
      │      ├─ 피처 엔지니어링
      │      └─ 모델 선택
      │
  [20-35분] 딥다이브 (면접관 관심 영역)
      │      ├─ 모델 학습/서빙
      │      ├─ 스케일링
      │      └─ 엣지 케이스 처리
      │
  [35-45분] 모니터링, 개선 방향, Q&A
```

## 2. 요구사항 명확화

설계를 시작하기 전 반드시 **기능적/비기능적 요구사항**을 명확히 해야 합니다. mlops 과정에서 다룬 프로덕션 관점이 여기서 빛을 발합니다.

| 구분 | 질문 예시 | 왜 중요한가 |
|------|----------|------------|
| 비즈니스 목표 | "최적화할 지표가 뭔가요?" | 모델 목적 함수 결정 |
| 사용자 규모 | "DAU가 얼마인가요?" | 서빙 아키텍처 결정 |
| 지연시간 | "실시간인가요, 배치인가요?" | 모델 복잡도 제약 |
| 데이터 | "레이블 데이터가 있나요?" | 지도/비지도 학습 결정 |
| 기존 시스템 | "현재 규칙 기반인가요?" | 점진적 개선 전략 |
| 공정성 | "민감한 속성이 있나요?" | responsible-ai 고려 |

```python
# 요구사항 체크리스트 (면접 시 머릿속에 두기)
requirements_checklist = {
    "functional": [
        "입력 데이터 형태와 출력 형태",
        "실시간 vs 배치 처리",
        "개인화 수준 (사용자별 vs 전체)",
    ],
    "non_functional": [
        "지연시간 SLA (p50, p99)",
        "처리량 (QPS)",
        "가용성 (99.9%? 99.99%?)",
        "데이터 프라이버시 제약",
    ],
}
```

> **핵심 직관**: 요구사항 질문 없이 바로 모델 이야기를 시작하면, 면접관에게 "이 사람은 프로덕션 경험이 없다"는 인상을 줍니다.

## 3. 메트릭 정의

ML 시스템에서 메트릭은 **오프라인(개발 단계)**과 **온라인(프로덕션)**으로 나뉩니다.

```
메트릭 체계:

  오프라인 메트릭                    온라인 메트릭
  ─────────────                    ────────────
  - AUC-ROC                       - CTR (클릭률)
  - Precision/Recall/F1           - 전환율
  - NDCG (랭킹)                   - 사용자 체류 시간
  - RMSE (회귀)                    - 매출
  - Perplexity (LM)               - DAU 변화

  오프라인 ↔ 온라인 괴리가 클 수 있다!
  → A/B 테스트로 검증 필수 (sd-10)
```

| 시스템 유형 | 오프라인 메트릭 | 온라인 메트릭 | 가드레일 |
|-----------|---------------|-------------|---------|
| 추천 (sd-02) | Recall@K, NDCG | CTR, 체류 시간 | 다양성, 신선도 |
| 검색 (sd-03) | MRR, NDCG | 클릭률, 재검색률 | 지연시간 |
| 광고 (sd-04) | AUC, LogLoss | 매출, eCPM | 사용자 경험 |
| 사기 탐지 (sd-06) | Precision, Recall | 탐지율, 오탐률 | 처리 지연 |

## 4. 시스템 아키텍처 설계

ML 시스템의 공통 아키텍처 패턴입니다.

```
┌──────────────────────────────────────────────────┐
│                ML 시스템 공통 아키텍처               │
├──────────────────────────────────────────────────┤
│                                                  │
│  [데이터 소스] → [데이터 파이프라인] → [피처 스토어]   │
│                                                  │
│  [피처 스토어] → [모델 학습] → [모델 레지스트리]      │
│                                                  │
│  [요청] → [피처 조회] → [모델 추론] → [후처리] → [응답]│
│                    ↑                              │
│              [모델 레지스트리]                       │
│                                                  │
│  [로깅] → [모니터링] → [재학습 트리거]               │
│                                                  │
└──────────────────────────────────────────────────┘
```

## 5. 모델 선택 전략

dl 과정에서 배운 모델들을 시스템 제약 조건에 맞춰 선택하는 기준입니다.

| 제약 조건 | 추천 모델 | 이유 |
|----------|----------|------|
| 지연시간 < 10ms | 로지스틱 회귀, 소형 트리 | 추론 속도 최우선 |
| 지연시간 < 100ms | LightGBM, 작은 DNN | 균형 잡힌 선택 |
| 지연시간 무관 (배치) | 대형 앙상블, 트랜스포머 | 정확도 최우선 |
| 레이블 부족 | 비지도 학습, self-supervised | 레이블 불필요 |
| 설명 가능성 필요 | 트리 모델, 선형 모델 | 해석 용이 |

```
모델 선택 결정 트리:

  레이블 데이터 있는가?
  ├─ Yes → 데이터량 충분한가?
  │        ├─ Yes → 딥러닝 고려 (dl 과정)
  │        └─ No  → 트리 모델 or 전이 학습
  └─ No  → 비지도 or 규칙 기반 시작
              → 점진적으로 레이블 수집
```

## 6. 트레이드오프 분석

면접에서 가장 높이 평가받는 능력은 **트레이드오프를 명확히 설명하는 것**입니다.

```
주요 트레이드오프 축:

  정확도 ←──────────→ 지연시간
  (복잡한 모델)         (단순한 모델)

  탐색(Exploration) ←→ 활용(Exploitation)
  (새로운 시도)         (검증된 결과)

  일반화 ←────────────→ 개인화
  (전체 모델 하나)       (사용자별 모델)

  실시간 ←────────────→ 배치
  (최신 반영)            (효율적 처리)

  자체 개발 ←──────────→ 외부 서비스
  (유연성)               (빠른 출시)
```

> **핵심 직관**: "A가 더 좋습니다"가 아니라 "이 상황에서는 A가 유리하지만, 만약 ~한다면 B를 고려해야 합니다"라고 말하는 것이 시니어의 답변입니다.

## 7. 실전 시나리오: 프레임워크 적용 예시

**문제**: "유튜브 같은 동영상 추천 시스템을 설계하세요."

```
프레임워크 적용:

  1. 요구사항
     - DAU 10억, 실시간 개인화 필요
     - 지연시간 < 200ms

  2. 메트릭
     - 오프라인: Recall@50, NDCG
     - 온라인: 시청 시간, CTR
     - 가드레일: 다양성, 저품질 콘텐츠 비율

  3. 아키텍처: 2단계 파이프라인
     - 후보 생성 (수백만 → 수천): 경량 모델
     - 랭킹 (수천 → 수십): 정밀 모델

  4. 트레이드오프
     - 시청 시간 최적화 vs 다양성 보장
     - 실시간 피처 vs 배치 피처 비용
```

이 프레임워크는 sd-02부터 sd-11까지의 모든 구체적 시스템 설계의 기초가 됩니다. 각 강의에서 이 프레임워크를 해당 도메인에 맞게 적용하는 방법을 배웁니다.

## 핵심 정리

- ML 시스템 설계 면접은 정답이 아니라 **체계적 사고 과정과 트레이드오프 논의**를 평가합니다
- 설계 전 반드시 **기능적/비기능적 요구사항**을 명확히 하고, 이것이 아키텍처 결정을 좌우합니다
- **오프라인 메트릭과 온라인 메트릭**을 구분하고, A/B 테스트로 괴리를 검증해야 합니다
- 모델 선택은 정확도만이 아니라 **지연시간, 설명 가능성, 데이터 가용성** 등 시스템 제약을 고려합니다
- 트레이드오프를 설명할 때 **"상황에 따라 다르다"를 구체적 조건과 함께** 제시하는 것이 핵심입니다
