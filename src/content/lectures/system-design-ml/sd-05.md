# 피드 랭킹 시스템

## 왜 피드 랭킹이 중요한가

페이스북, 인스타그램, 트위터, 링크드인 등 소셜 미디어의 핵심은 **피드 랭킹**입니다. 사용자가 팔로우하는 수백 명의 콘텐츠 중 어떤 것을 상단에 배치할지 결정하는 것이 사용자 체류 시간과 플랫폼 가치를 좌우합니다. sd-02의 추천 시스템과 유사하지만, 소셜 시그널과 다목적 최적화라는 고유한 도전이 있습니다.

> **핵심 직관**: 피드 랭킹의 핵심 딜레마는 "사용자가 클릭하는 것"과 "사용자에게 가치 있는 것"이 항상 일치하지 않는다는 점입니다. 클릭베이트 최적화는 단기적으로 지표를 올리지만 장기적으로 플랫폼을 망칩니다.

## 1. 피드 랭킹 아키텍처

```
피드 랭킹 파이프라인:

  [피드 요청]
       │
       ▼
  [후보 수집 Candidate Sourcing]
  ├─ 팔로우 중인 계정의 최신 콘텐츠
  ├─ 그룹/커뮤니티 콘텐츠
  ├─ 광고 (sd-04)
  └─ 추천 콘텐츠 ("추천 게시물")
       │
       ▼ (수천 개)
  [경량 랭킹 L1]
  └─ 간단한 모델로 빠르게 필터링 → 수백 개
       │
       ▼
  [정밀 랭킹 L2]
  └─ 무거운 모델로 정밀 점수화
       │
       ▼
  [리랭킹 / 정책 적용]
  ├─ 다양성 보장
  ├─ 작성자 공정성
  └─ 콘텐츠 정책 필터
       │
       ▼
  [최종 피드 (20-50개)]
```

## 2. 다목적 최적화

피드 랭킹의 가장 큰 특징은 **단일 목표가 아닌 여러 목표를 동시에 최적화**해야 한다는 점입니다.

```
다목적 최적화:

  최종 점수 = w₁ × P(클릭) + w₂ × P(좋아요) + w₃ × P(댓글)
            + w₄ × P(공유) + w₅ × P(시청 완료)
            - w₆ × P(숨김) - w₇ × P(신고)

  가중치(w)는 비즈니스 목표에 따라 조정:
  ├─ 체류 시간 중시  → 시청 완료 가중치 ↑
  ├─ 참여도 중시     → 댓글/공유 가중치 ↑
  └─ 건전성 중시     → 신고/숨김 페널티 ↑
```

| 행동 | 긍정/부정 | 난이도 | 가중치 (예시) |
|------|----------|--------|-------------|
| 클릭 | 긍정 | 쉬움 | 1.0 |
| 좋아요 | 긍정 | 중간 | 2.0 |
| 댓글 | 긍정 | 어려움 | 3.0 |
| 공유 | 강한 긍정 | 매우 어려움 | 5.0 |
| 숨김 | 부정 | — | -10.0 |
| 신고 | 강한 부정 | — | -50.0 |

> **핵심 직관**: 가중치 조정은 기술적 문제가 아니라 **제품 철학**의 문제입니다. "댓글을 3배로 높이면 참여도는 오르지만 논쟁적 콘텐츠가 올라갑니다" — 이런 트레이드오프를 면접에서 논의할 수 있어야 합니다.

## 3. 랭킹 피처 설계

```
피드 랭킹 피처 카테고리:

  [작성자 피처]          [콘텐츠 피처]          [관계 피처]
  - 팔로워 수            - 콘텐츠 유형          - 상호 팔로우 여부
  - 평균 참여율          - 게시 시간            - 최근 상호작용 빈도
  - 콘텐츠 생산 빈도      - 미디어 포함 여부      - 메시지 교환 이력
  - 신뢰도 점수          - 텍스트 길이          - 공통 친구 수

  [컨텍스트 피처]         [과거 행동 피처]
  - 접속 시간대           - 유사 콘텐츠 클릭 이력
  - 디바이스             - 작성자 콘텐츠 반응률
  - 세션 내 소비 패턴     - 최근 숨김/신고 이력
```

```python
# 피드 스코어링 (단순화된 다목적 모델)
class FeedRanker:
    def __init__(self, action_weights: dict[str, float]):
        self.weights = action_weights  # 행동별 가중치
        self.models = {}  # 행동별 예측 모델

    def score(self, user, post, context) -> float:
        """다목적 점수 계산"""
        features = self.extract_features(user, post, context)
        total = 0.0
        for action, weight in self.weights.items():
            prob = self.models[action].predict(features)
            total += weight * prob
        return total

    def rank_feed(self, user, candidates, context) -> list:
        """후보 콘텐츠를 점수순 정렬"""
        scored = [(post, self.score(user, post, context))
                  for post in candidates]
        scored.sort(key=lambda x: x[1], reverse=True)
        return self.apply_diversity(scored)  # 다양성 적용
```

## 4. 다양성과 신선도

점수만으로 정렬하면 비슷한 콘텐츠가 연속으로 나오는 문제가 발생합니다.

```
다양성 보장 전략:

  전략 1: MMR (Maximal Marginal Relevance)
  └─ 관련도 높으면서 기존 선택과 다른 콘텐츠 우선

  전략 2: 카테고리 분산
  └─ 연속 3개 이상 같은 유형 금지 (사진, 영상, 텍스트)

  전략 3: 작성자 분산
  └─ 같은 작성자의 콘텐츠 연속 노출 제한

  전략 4: 시간 감쇠
  └─ 오래된 콘텐츠에 감쇠 적용
     score_final = score × decay(age)
     decay(t) = 1 / (1 + α × t)
```

| 전략 | 장점 | 단점 |
|------|------|------|
| MMR | 수학적으로 엄밀 | 계산 비용 O(n²) |
| 카테고리 분산 | 구현 간단 | 규칙이 경직적 |
| 작성자 분산 | 공정성 향상 | 인기 작성자 노출 감소 |
| 시간 감쇠 | 신선도 보장 | 고품질 구작 매몰 |

## 5. 필터 버블과 공정성

피드 랭킹이 개인화를 극대화하면 **필터 버블**(사용자가 편향된 정보에만 노출되는 현상)이 발생합니다.

```
필터 버블 완화 전략:

  1. 의도적 탐색 (Exploration)
     └─ 전체 피드의 5-10%를 "탐색 슬롯"으로 할당
        → 사용자의 기존 패턴과 다른 콘텐츠 노출

  2. 관점 다양성
     └─ 논쟁적 주제에서 다양한 관점의 콘텐츠 혼합

  3. 작성자 노출 공정성
     └─ 소규모 크리에이터에게도 최소 노출 보장
        → responsible-ai 과정에서 다룬 공정성 원칙 적용

  4. 투명성
     └─ "이 게시물이 표시되는 이유" 기능 제공
```

> **핵심 직관**: 필터 버블은 기술적 문제인 동시에 사회적 문제입니다. 면접에서 이 주제를 자발적으로 언급하면 시스템의 사회적 영향까지 고려하는 시니어의 시각을 보여줄 수 있습니다.

## 6. 실시간 개인화

```
실시간 피드 업데이트:

  세션 시작 (초기 피드 로드)
       │
       ├─ 사용자가 게시물 A를 3초 만에 스크롤 (비관심)
       │   → 유사 콘텐츠 점수 하향 조정
       │
       ├─ 사용자가 게시물 B에 좋아요 (관심)
       │   → 유사 콘텐츠 점수 상향, 작성자 점수 상향
       │
       └─ 다음 페이지 로드 시 반영
           → 세션 내 행동이 실시간으로 피드에 영향
```

피드 랭킹은 sd-02(추천)의 파이프라인을 소셜 맥락에 맞게 확장한 것입니다. 다목적 최적화와 다양성이라는 고유한 도전이 이 시스템을 특별하게 만듭니다.

## 핵심 정리

- 피드 랭킹은 **다목적 최적화**로 클릭, 좋아요, 공유 등 여러 행동의 가중합을 점수로 사용합니다
- 가중치 설정은 기술이 아닌 **제품 철학**의 문제이며, 비즈니스 목표에 따라 달라집니다
- **다양성 보장**(MMR, 카테고리 분산, 작성자 분산)은 사용자 만족도를 유지하는 데 필수입니다
- **필터 버블** 문제는 의도적 탐색 슬롯과 관점 다양성으로 완화할 수 있습니다
- 세션 내 **실시간 행동 피드백**을 반영하여 피드를 동적으로 조정하면 개인화 품질이 크게 향상됩니다
