# 이분 매칭과 할당 문제

## 왜 이분 매칭이 중요한가

"학생들을 프로젝트에 배정", "구직자를 일자리에 매칭", "서버를 요청에 할당"—이 모든 문제가 **이분 매칭(Bipartite Matching)**입니다. ga-04의 네트워크 플로우를 이분 그래프에 특화하면 더 효율적인 알고리즘을 얻을 수 있으며, 가중치를 추가하면 **할당 문제(Assignment Problem)**가 됩니다.

> **핵심 직관**: 이분 매칭의 핵심은 **증가 경로(Augmenting Path)**입니다. 매칭에 포함되지 않은 간선과 포함된 간선을 번갈아 따라가는 경로를 찾으면 매칭 크기를 1 늘릴 수 있습니다. 증가 경로가 없으면 현재 매칭이 최대입니다.

## 1. 이분 그래프와 매칭

```
이분 그래프 (Bipartite Graph):

  노드를 두 그룹 L, R로 나눌 수 있고
  간선이 항상 L↔R 사이에만 존재

  L (학생):  [A] [B] [C] [D]
              |\ | / | /
  R (프로젝트):[1] [2] [3]

  매칭 (Matching):
  간선 집합에서, 각 노드가 최대 하나의 간선에만 포함

  최대 매칭:
  A─1, B─2, C─3 → 크기 3 (최대)

  완전 매칭 (Perfect Matching):
  모든 노드가 매칭됨 (|L| = |R|일 때)
```

## 2. 헝가리안 알고리즘 (Kuhn's Algorithm)

```python
def max_bipartite_matching(graph, n_left, n_right):
    """graph[u] = [v, ...] (u in L, v in R)"""
    match_r = [-1] * n_right  # R의 각 노드가 매칭된 L 노드

    def dfs(u, visited):
        for v in graph[u]:
            if visited[v]:
                continue
            visited[v] = True
            # v가 비었거나, v의 현재 파트너를 다른 곳으로 보낼 수 있으면
            if match_r[v] == -1 or dfs(match_r[v], visited):
                match_r[v] = u
                return True
        return False

    result = 0
    for u in range(n_left):
        visited = [False] * n_right
        if dfs(u, visited):
            result += 1
    return result
```

```
동작 원리:

  각 L 노드에 대해 증가 경로를 DFS로 탐색
  증가 경로: 비매칭 L → 비매칭 R 또는
            비매칭 L → 매칭 R → 매칭 L → ... → 비매칭 R

  예:
  현재 매칭: A─1, B─2
  C의 증가 경로: C → 1 → A → 2 → B → 3
  → 매칭 변경: C─1, A─2, B─3 (크기 2 → 3)

  시간: O(V × E)
  각 L 노드(V)에 대해 DFS(E)
```

> **핵심 직관**: DFS에서 `match_r[v] == -1 or dfs(match_r[v], visited)`가 핵심입니다. "v가 비었으면 바로 매칭, 아니면 v의 현재 파트너를 **다른 곳으로 밀어내기 시도**"하는 재귀적 양보가 증가 경로 탐색의 본질입니다.

## 3. Hopcroft-Karp 알고리즘

```
Hopcroft-Karp:

  Kuhn's: 한 번에 증가 경로 1개 → O(V × E)
  Hopcroft-Karp: BFS로 최단 증가 경로를 동시에 여러 개 → O(E√V)

  과정:
  1. BFS로 최단 증가 경로의 길이를 결정 (레벨 그래프)
  2. DFS로 해당 길이의 증가 경로를 모두 찾아 동시 적용
  3. 증가 경로가 없을 때까지 반복

  반복 횟수: O(√V)번 (핵심 관찰)
  각 반복: O(E)
  → 총 O(E√V)

  Dinic의 플로우 알고리즘과 동일한 아이디어!
  (ga-04에서 이분 그래프에 Dinic → O(E√V))
```

| 알고리즘 | 시간 | 적합 |
|---------|------|------|
| Kuhn (DFS) | $O(VE)$ | 소규모, 구현 간단 |
| Hopcroft-Karp | $O(E\sqrt{V})$ | 대규모 이분 매칭 |
| 플로우 (Dinic) | $O(E\sqrt{V})$ | 범용, 확장 쉬움 |

## 4. 가중 이분 매칭 (Hungarian Algorithm)

```
할당 문제 (Assignment Problem):

  N명의 작업자를 N개 작업에 1:1 배정
  각 (작업자, 작업) 쌍의 비용이 주어질 때 총 비용 최소화

  비용 행렬:
       작업1 작업2 작업3
  A:    8     4     2
  B:    4     2     6
  C:    6     8     4

  Hungarian Algorithm:
  1. 각 행에서 최솟값 빼기 → 0 포함 행렬
  2. 각 열에서 최솟값 빼기
  3. 최소 줄 수로 모든 0을 덮기
  4. 줄 수 < N이면: 덮이지 않은 최솟값으로 조정
  5. 줄 수 = N이면: 0 위치에서 완전 매칭 찾기

  시간: O(N³)

  예시 진행:
  Step 1 (행 감소):     Step 2 (열 감소):
  [6, 2, 0]            [4, 0, 0]
  [2, 0, 4]            [0, -2, 4] → 조정
  [2, 4, 0]            [0, 2, 0]
```

> **핵심 직관**: Hungarian Algorithm의 핵심 아이디어는 **"비용 행렬에서 0을 만들어 그 위치에서 매칭을 찾는 것"**입니다. 행/열에서 상수를 빼도 최적 할당은 변하지 않으므로(상수 이동), 0이 최대한 많은 행렬을 만들어 매칭을 용이하게 합니다.

## 5. König의 정리

```
König의 정리:

  이분 그래프에서:
  최대 매칭 크기 = 최소 정점 커버 크기

  정점 커버 (Vertex Cover):
  모든 간선의 적어도 한쪽 끝점을 포함하는 노드 집합

  최소 정점 커버 찾기:
  1. 최대 매칭 실행
  2. 매칭 안 된 L 노드에서 증가 경로 탐색 (alternating BFS)
  3. BFS로 도달 가능한 노드 집합 = Z
  4. 최소 커버 = (L - Z) ∪ (R ∩ Z)

  쌍대:
  최대 독립 집합 = V - 최소 정점 커버
  최소 간선 커버 = V - 최대 매칭 (고립 노드 없을 때)

  일반 그래프에서 최소 정점 커버는 NP-hard!
  → 이분 그래프의 특별한 성질
```

## 6. 실전 응용

```
응용 1: 좌석 배정
  N명의 손님을 M개 테이블에 배정 (선호 테이블 존재)
  → 이분 매칭

응용 2: 시간표 작성
  교수를 시간대에 배정 (가능한 시간대 존재)
  → 가중 이분 매칭 (선호도 최대화)

응용 3: 추천 시스템
  사용자-아이템 매칭 최적화
  → 온라인 이분 매칭 (ad-12)

응용 4: 컴파일러 레지스터 할당
  변수를 레지스터에 배정
  → 그래프 컬러링 (이분이면 2-색으로 충분)

면접 팁:
  "이분 매칭"이라는 키워드보다
  "1:1 대응", "배정", "할당"이라는 문제 설명에서
  이분 매칭을 떠올리는 것이 핵심
```

이분 매칭은 ga-04의 플로우를 특화한 것이며, ad-07의 근사 알고리즘에서 정점 커버 근사에 활용됩니다.

## 핵심 정리

- **이분 매칭**은 L, R 두 그룹 간의 최대 1:1 대응을 찾으며, 증가 경로가 핵심 개념입니다
- **Kuhn's Algorithm**은 DFS로 $O(VE)$, **Hopcroft-Karp**는 BFS+DFS로 $O(E\sqrt{V})$에 최대 매칭을 구합니다
- **Hungarian Algorithm**은 가중 이분 매칭(할당 문제)을 $O(N^3)$에 해결하며, 비용 행렬에서 0을 만들어 매칭합니다
- **König의 정리**: 이분 그래프에서 최대 매칭 = 최소 정점 커버이며, 이는 일반 그래프에서는 성립하지 않습니다
- 실전에서 "배정", "할당", "1:1 대응" 키워드가 보이면 이분 매칭을 떠올려야 합니다
