# 온라인 알고리즘

## 왜 온라인 알고리즘이 중요한가

지금까지의 알고리즘은 입력 전체를 알고 있는 **오프라인(offline)** 설정이었습니다. 하지만 실무에서는 입력이 하나씩 도착하고, 각 입력에 대해 **즉시 결정**해야 하는 경우가 많습니다. 캐시 교체 정책, 온라인 광고 배정, 채용 면접에서의 후보 선택 등이 대표적입니다. **온라인 알고리즘(Online Algorithm)**은 미래를 모른 채 결정하며, **경쟁비(Competitive Ratio)**로 오프라인 최적해 대비 성능을 측정합니다.

> **핵심 직관**: 온라인 알고리즘의 핵심 질문은 **"미래를 모르는 것의 비용이 얼마인가?"**입니다. 경쟁비 α는 "전지전능한 신과 비교했을 때 α배 이내"라는 보장입니다. 어떤 문제에서는 이 비용이 상수이고(페이징), 어떤 문제에서는 로그(스키 렌탈)입니다.

## 1. 경쟁비 정의

```
온라인 알고리즘의 성능 측정:

  입력 시퀀스 σ = σ₁, σ₂, ..., σₙ (하나씩 도착)
  ALG(σ): 온라인 알고리즘의 비용
  OPT(σ): 오프라인 최적해의 비용 (미래를 다 아는 경우)

  경쟁비 (Competitive Ratio):
  ALG(σ) ≤ α · OPT(σ) + β (모든 σ에 대해)

  α: 경쟁비 (작을수록 좋음)
  β: 상수 (보통 무시)

  α-경쟁적: 오프라인 최적의 α배 이내 보장

  결정적 (Deterministic): 랜덤 없이 결정
  랜덤화 (Randomized): 랜덤 선택 허용
  → 랜덤화가 보통 더 좋은 경쟁비 달성

  적대적 (Adversarial) 입력:
  알고리즘의 전략을 아는 적이 최악 입력을 만듦
  → 결정적이면 적이 쉽게 공략
  → 랜덤화면 적도 기대값만 공략 가능
```

## 2. Secretary Problem

```
Secretary Problem (비서 문제):

  N명의 후보를 순서대로 면접
  각 후보를 면접 후 즉시 채용/거부 결정
  거부하면 되돌릴 수 없음
  목표: 최고의 후보를 채용할 확률 최대화

  최적 전략 (1/e Stopping Rule):
  1. 처음 N/e명 (≈ 37%)은 무조건 거부 (탐색)
  2. 이후, 지금까지 최고보다 나은 첫 후보를 채용 (활용)

  성공 확률: ≈ 1/e ≈ 36.8% (N → ∞)

  증명 직관:
  최고 후보가 위치 i에 있을 때 (i > N/e)
  성공 ⟺ 위치 1~i-1의 최고가 1~N/e에 있음
  확률 = (N/e) / (i-1)
  합산: Σ_{i=N/e+1}^{N} (1/N) × (N/e)/(i-1) ≈ 1/e
```

```python
import math

def secretary_strategy(candidates):
    """candidates[i] = i번째 후보의 점수 (순서대로 도착)"""
    n = len(candidates)
    skip = max(1, int(n / math.e))  # 탐색 단계

    # 탐색: 처음 skip명의 최고 점수 기록
    threshold = max(candidates[:skip])

    # 활용: threshold보다 나은 첫 후보 채용
    for i in range(skip, n):
        if candidates[i] > threshold:
            return i, candidates[i]

    # 아무도 안 뽑히면 마지막 후보
    return n - 1, candidates[-1]
```

```
변형:
  ├─ K명 채용: 다중 Secretary Problem
  ├─ 비용 최소화: 채용 비용 + 대기 비용
  ├─ 값 최대화: 절대 점수 기반 (가격 포함)
  └─ 양방향: 후보도 거부 가능

  실전:
  ├─ 집 구매: 여러 집을 보고 결정 (37% 탐색)
  ├─ 주차: 가까운 빈 자리를 즉시 결정
  └─ 온라인 경매: 입찰 시점 결정
```

> **핵심 직관**: Secretary Problem은 **"탐색(Exploration)과 활용(Exploitation)의 균형"**이라는 보편적 원리의 원형입니다. 37%를 탐색에, 63%를 활용에 쓰는 것이 최적이며, 이 원리는 강화학습(rl-03)의 ε-greedy와 동일한 맥락입니다.

## 3. 온라인 페이징 (Caching)

```
페이징 문제:

  캐시 크기 k, 페이지 요청 시퀀스 도착
  캐시 미스 시 어떤 페이지를 교체할지 결정
  목표: 캐시 미스 횟수 최소화

  오프라인 최적: Bélády의 알고리즘 (MIN)
  → "가장 나중에 사용될 페이지"를 교체
  → 미래를 알아야 하므로 온라인 불가!

  온라인 전략:
  ├─ LRU (Least Recently Used): 가장 오래 안 쓴 페이지 교체
  ├─ FIFO (First In First Out): 가장 먼저 들어온 것 교체
  ├─ LFU (Least Frequently Used): 가장 적게 쓴 것 교체
  └─ LIFO (Last In First Out): 가장 최근 들어온 것 교체

  경쟁비:
  LRU: k-경쟁적 (결정적 하한 = k)
  FIFO: k-경쟁적
  LIFO: 무한 (경쟁적이지 않음!)
  랜덤 Marking: O(log k)-경쟁적

  결정적 하한: k (어떤 결정적 알고리즘도 k보다 좋을 수 없음)
  랜덤화 하한: H_k = O(log k) (최적!)
```

```
LRU가 k-경쟁적인 증명 직관:

  적이 k+1개 페이지를 번갈아 요청 → 매번 미스
  LRU: k+1번 요청마다 k번 미스
  OPT: k+1번 요청마다 1번 미스
  → 비율: k

  실무에서 LRU가 좋은 이유:
  실제 접근 패턴은 적대적이지 않음
  시간적 지역성(Temporal Locality) → 최근 것이 다시 사용됨
  → 최악 k-경쟁적이지만 실무에서는 거의 최적
```

## 4. 온라인 매칭

```
온라인 이분 매칭:

  L 노드는 미리 알려짐, R 노드가 하나씩 도착
  R 노드 도착 시 연결할 L 노드를 즉시 결정 (또는 매칭 안 함)
  결정은 되돌릴 수 없음

  결정적: 1/2-경쟁적 (최선)
  그리디: 아무 이웃에 매칭 → 1/2

  RANKING 알고리즘 (Karp, Vazirani, Vazirani 1990):
  L 노드에 랜덤 순위 부여
  R 노드 도착 시 가장 순위 높은 미매칭 이웃에 연결
  → (1 - 1/e) ≈ 0.632-경쟁적
  → 이것이 최적! (랜덤화 상한도 1 - 1/e)

  응용: 온라인 광고 배정
  L = 광고주, R = 사용자 (하나씩 도착)
  각 사용자에게 어떤 광고를 보여줄지 실시간 결정
  → Google AdWords의 핵심 문제
```

## 5. 스키 렌탈 문제

```
Ski Rental (Rent or Buy):

  매일 스키장 방문, 스키 대여비 $1/일
  스키 구매비 $B
  미래에 몇 번 더 갈지 모름
  언제 구매할지 결정

  결정적 최적: B일째에 구매
  경쟁비: 2 - 1/B

  증명:
  실제 방문 일수 = n
  Case 1 (n < B): 대여만 → 비용 n, OPT = n → 비율 1
  Case 2 (n ≥ B): B일 대여 + 구매 = 2B - 1, OPT = B → 비율 2-1/B

  랜덤화: 기대 경쟁비 e/(e-1) ≈ 1.58

  일반화 — Rent/Buy 패러다임:
  ├─ TCP 확인응답: ACK를 모을지 즉시 보낼지
  ├─ 캐시 워밍업: 데이터를 캐시에 올릴지 말지
  └─ 클라우드: 인스턴스를 빌릴지 예약할지
```

> **핵심 직관**: 스키 렌탈의 교훈은 **"확실하지 않으면 일단 싼 옵션을 선택하되, 비용이 비싼 옵션 가격에 도달하면 전환"**하라는 것입니다. 이 "break-even" 전략은 놀라울 정도로 보편적이며, 클라우드 예약 인스턴스 결정에 직접 적용됩니다.

## 6. 실전 응용 정리

```
온라인 알고리즘이 쓰이는 곳:

  운영체제:
  ├─ 페이지 교체: LRU, CLOCK
  ├─ 디스크 스케줄링: SCAN, C-SCAN
  └─ 프로세스 스케줄링: Round Robin

  네트워크:
  ├─ 라우팅: 실시간 경로 결정
  ├─ 로드 밸런싱: 요청을 어느 서버로
  └─ TCP 혼잡 제어: 윈도우 크기 결정

  경제/비즈니스:
  ├─ 주가 예측: 매수/매도 시점
  ├─ 온라인 광고: 광고 배정 (RANKING)
  └─ 가격 결정: 동적 가격 책정

  | 문제 | 결정적 | 랜덤화 | 하한 |
  |------|--------|--------|------|
  | 페이징 | k | O(log k) | Ω(log k) |
  | Secretary | 1/e | 1/e | 1/e |
  | 이분 매칭 | 1/2 | 1-1/e | 1-1/e |
  | 스키 렌탈 | 2 | e/(e-1) | e/(e-1) |
```

온라인 알고리즘은 ga-05의 매칭(오프라인 이분 매칭과 비교), ad-08의 랜덤화(RANKING 알고리즘), dp-04의 스트림 처리(실시간 결정)와 연결됩니다.

## 핵심 정리

- **경쟁비**는 온라인 알고리즘과 오프라인 최적해의 비율이며, 미래를 모르는 것의 비용을 측정합니다
- **Secretary Problem**의 최적 전략은 처음 $N/e$명을 탐색 후 최고를 넘는 첫 후보를 채용하며, 성공 확률 $1/e \approx 37\%$입니다
- **LRU**는 $k$-경쟁적이며 결정적 하한과 일치하지만, 실제 워크로드에서는 지역성 덕분에 거의 최적입니다
- **RANKING**은 온라인 이분 매칭에서 $(1-1/e)$-경쟁적이며, 이것이 랜덤화 상한입니다 (온라인 광고의 핵심)
- **스키 렌탈**의 "break-even에서 전환" 전략은 결정적 2-경쟁, 랜덤화 $e/(e-1)$-경쟁이며, Rent/Buy 문제의 원형입니다
