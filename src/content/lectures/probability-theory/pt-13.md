# 측도론적 확률 기초

## 왜 측도론을 배워야 하는가

pt-01에서 확률 공간 $(\Omega, \mathcal{F}, P)$를 소개했지만, 시그마 대수와 측도의 깊은 의미는 다루지 않았습니다. 이산과 연속 확률 변수를 별도로 다루는 것은 비효율적이며, 둘이 혼합된 분포(예: zero-inflated 모델, dropout의 수학적 기술)는 전통적 방법으로 다루기 어렵습니다. **측도론(measure theory)**은 이 모든 것을 통일적으로 다루는 프레임워크입니다.

이번 강의에서는 측도 공간, 르베그 적분, 라돈-니코딤 정리를 직관적으로 다룹니다. 엄밀한 증명보다는 ML에 필요한 수준의 이해를 목표로 합니다.

---

## 1. 측도 공간

**측도(measure)** $\mu: \mathcal{F} \to [0, \infty]$는 다음을 만족하는 집합 함수입니다:

1. $\mu(\emptyset) = 0$
2. **가산 가법성**: 서로소인 $A_1, A_2, \ldots \in \mathcal{F}$에 대해

$$
\mu\!\left(\bigcup_{i=1}^{\infty} A_i\right) = \sum_{i=1}^{\infty} \mu(A_i)
$$

$(\Omega, \mathcal{F}, \mu)$를 **측도 공간(measure space)**이라 합니다.

### 측도의 종류

| 측도 | 정의 | 직관 |
|------|------|------|
| 셈 측도 (counting measure) | $\mu(A) = \|A\|$ (원소 개수) | 이산 확률의 기초 |
| 르베그 측도 (Lebesgue measure) | $\mu([a,b]) = b - a$ (길이) | 연속 확률의 기초 |
| 확률 측도 | $P(\Omega) = 1$인 측도 | 확률 |
| 디랙 측도 | $\delta_a(A) = \mathbf{1}(a \in A)$ | 점 질량 |

> **핵심 직관**: 측도는 "집합의 크기를 재는 자"입니다. 셈 측도로 재면 이산 확률이 되고, 르베그 측도로 재면 연속 확률이 됩니다. 이 관점에서 PMF와 PDF는 "참조 측도에 대한 밀도"라는 하나의 개념으로 통일됩니다.

---

## 2. 가측 함수와 적분

### 가측 함수

$f: \Omega \to \mathbb{R}$이 **가측(measurable)**이란:

$$
\{\omega \in \Omega : f(\omega) \leq a\} \in \mathcal{F} \quad \forall a \in \mathbb{R}
$$

pt-01에서 확률 변수가 "가측 함수"라고 했던 것의 정확한 의미입니다.

### 르베그 적분의 아이디어

리만 적분은 $x$축을 분할하지만, 르베그 적분은 **$y$축(치역)**을 분할합니다.

```
리만 적분 vs 르베그 적분
──────────────────────────────────────────
리만 (정의역 분할)        르베그 (치역 분할)

f(x) ▲                    f(x) ▲
     │ ┌┐┌┐               │ ████████  ← y₃
     │ │││├┐              │ ████████  ← y₂
     │┌┤│││├┐             │ ████████  ← y₁
     └┴┴┴┴┴┴┴─► x         └──────────► x
     Δx₁ Δx₂...          μ({f ≥ y₁}), μ({f ≥ y₂}), ...
──────────────────────────────────────────
```

형식적 정의:

$$
\int_\Omega f\,d\mu = \sup\left\{\sum_{i} c_i\,\mu(A_i) : 0 \leq s \leq f,\; s = \sum_i c_i \mathbf{1}_{A_i}\right\}
$$

르베그 적분의 장점:
- 리만 적분 불가능한 함수도 적분 가능 (예: 디리클레 함수)
- 극한과 적분의 교환 (지배 수렴 정리, 단조 수렴 정리)
- 이산과 연속의 통일적 처리

---

## 3. 기댓값의 통일적 정의

확률 변수 $X$의 기댓값은 확률 측도 $P$에 대한 르베그 적분입니다:

$$
\mathbb{E}[X] = \int_\Omega X(\omega)\,dP(\omega)
$$

이산의 경우 ($P$가 셈 측도 기반):

$$
\mathbb{E}[X] = \sum_x x\,p(x)
$$

연속의 경우 ($P$가 르베그 측도 기반):

$$
\mathbb{E}[X] = \int x\,f(x)\,dx
$$

두 공식이 하나의 정의에서 나옵니다.

> **핵심 직관**: 측도론의 관점에서, 이산과 연속의 구분은 "참조 측도의 선택"일 뿐입니다. $\sum$과 $\int$는 모두 르베그 적분의 특수 경우입니다.

---

## 4. 라돈-니코딤 정리

측도 $\nu$가 측도 $\mu$에 대해 **절대 연속(absolutely continuous)**이면 ($\nu \ll \mu$):

$$
\mu(A) = 0 \Rightarrow \nu(A) = 0 \quad \forall A \in \mathcal{F}
$$

이때 **라돈-니코딤 도함수(Radon-Nikodym derivative)**가 존재합니다:

$$
\frac{d\nu}{d\mu}: \Omega \to [0, \infty), \quad \nu(A) = \int_A \frac{d\nu}{d\mu}\,d\mu \quad \forall A \in \mathcal{F}
$$

### ML에서의 의미

| 측도론 | 확률론 대응 |
|--------|------------|
| $\mu$ = 셈 측도, $\nu$ = 확률 측도 | $\frac{d\nu}{d\mu} = p(x)$ (PMF) |
| $\mu$ = 르베그 측도, $\nu$ = 확률 측도 | $\frac{d\nu}{d\mu} = f(x)$ (PDF) |
| $\mu$ = 사전×우도, $\nu$ = 사후 | 베이즈 업데이트 |

> **핵심 직관**: **밀도 함수(PMF/PDF)는 라돈-니코딤 도함수의 특수 경우**입니다. 이 관점에서 PMF와 PDF의 구분은 사라지고, "참조 측도에 대한 밀도"라는 하나의 개념으로 통일됩니다. 정규화 흐름(normalizing flow)에서 변수 변환 시 야코비안이 등장하는 이유도 측도 변환 정리에서 비롯됩니다.

---

## 5. 측도 변환과 야코비안

확률 변수 $X$에 미분 가능한 단사 함수 $Y = g(X)$를 적용하면:

$$
f_Y(y) = f_X(g^{-1}(y)) \left|\det \frac{\partial g^{-1}}{\partial y}\right|
$$

la-05에서 다뤘던 야코비안의 행렬식이 여기서 등장합니다. 정규화 흐름(normalizing flow)은 이 공식을 반복 적용하여 복잡한 분포를 모델링합니다.

---

## 6. 중요한 수렴 정리들

| 정리 | 조건 | 결론 |
|------|------|------|
| 단조 수렴 정리 (MCT) | $0 \leq f_n \uparrow f$ | $\int f_n\,d\mu \to \int f\,d\mu$ |
| 지배 수렴 정리 (DCT) | $\|f_n\| \leq g$, $\int g < \infty$ | $\int \lim f_n = \lim \int f_n$ |
| Fatou의 보조정리 | $f_n \geq 0$ | $\int \liminf f_n \leq \liminf \int f_n$ |

ML에서 DCT는 "파라미터에 대한 미분을 적분 안으로 넣어도 되는가"의 정당화에 사용됩니다 (예: 점수 함수 추정량).

---

## 7. Python으로 확인하기

```python
import numpy as np
from scipy import stats

# --- 이산-연속 혼합 분포 ---
# P(X=0) = 0.3 (점 질량), X > 0이면 Exp(1) (연속)
# 이것은 셈 측도 + 르베그 측도의 혼합으로 기술됨

def mixed_sample(n, p_zero=0.3, lam=1.0):
    """이산-연속 혼합 분포에서 샘플링"""
    is_zero = np.random.binomial(1, p_zero, size=n)
    continuous = np.random.exponential(1/lam, size=n)
    return np.where(is_zero, 0, continuous)

samples = mixed_sample(100000)
print(f"P(X=0) 이론: 0.3, 경험: {np.mean(samples == 0):.4f}")
print(f"E[X] 이론: {0.7 * 1.0:.4f}, 경험: {samples.mean():.4f}")

# --- 변수 변환 (야코비안) ---
# X ~ N(0,1), Y = exp(X) (로그정규)
X = np.random.normal(0, 1, size=100000)
Y = np.exp(X)

# 로그정규의 이론적 평균: exp(μ + σ²/2) = exp(0.5)
print(f"\nE[Y] 이론: {np.exp(0.5):.4f}, 경험: {Y.mean():.4f}")

# PDF 변환 검증: f_Y(y) = f_X(log y) * (1/y)
y_test = 2.0
pdf_Y_theory = stats.norm.pdf(np.log(y_test)) / y_test
pdf_Y_scipy = stats.lognorm(s=1, scale=1).pdf(y_test)
print(f"f_Y({y_test}) 변환: {pdf_Y_theory:.6f}, scipy: {pdf_Y_scipy:.6f}")

# --- 지배 수렴 정리 확인 ---
# f_n(x) = x^n * exp(-x), x > 0에서 f_n → 0 (점별)
# |f_n| ≤ e^{-x/2} (지배 함수) for large n
# ∫ f_n dx = Γ(n+1) / ... → 0

# 실용적 검증: 파라미터 미분과 적분의 교환
theta = 2.0
eps = 1e-5
n_mc = 100000

# d/dθ E_θ[X²] where X ~ Exp(θ)
# 해석적: d/dθ (2/θ²) = -4/θ³
analytic = -4 / theta**3

# 수치적: (E_{θ+ε}[X²] - E_{θ-ε}[X²]) / (2ε)
samples_plus = np.random.exponential(1/(theta+eps), n_mc)
samples_minus = np.random.exponential(1/(theta-eps), n_mc)
numerical = ((samples_plus**2).mean() - (samples_minus**2).mean()) / (2*eps)

print(f"\nd/dθ E[X²] 해석적: {analytic:.4f}, 수치적: {numerical:.4f}")
```

---

## 핵심 정리

1. **측도**는 "집합의 크기를 재는 함수"이며, 셈 측도(이산)와 르베그 측도(연속)를 통일적으로 다루는 프레임워크를 제공한다.
2. **르베그 적분**은 치역을 분할하여 적분하며, 리만 적분보다 넓은 함수 클래스를 다루고 극한·적분 교환을 보장한다.
3. **라돈-니코딤 정리**에 의해 밀도 함수(PMF/PDF)는 "참조 측도에 대한 도함수"로 통일되며, 밀도의 존재를 보장한다.
4. **측도 변환**에서 야코비안 행렬식이 등장하며, 이것이 정규화 흐름(normalizing flow)의 수학적 기초이다.
5. **지배 수렴 정리(DCT)**는 적분과 극한/미분의 교환을 정당화하며, ML에서 그래디언트 추정의 이론적 기초이다.
