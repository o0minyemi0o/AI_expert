# 행렬 분해 총정리

## 왜 행렬 분해를 총정리해야 하는가

지금까지 고유값 분해, SVD, Cholesky, QR 등 여러 분해를 배웠습니다. 하지만 실전에서 "이 문제에 어떤 분해를 써야 하는가?"를 판단하려면 각 분해의 **적용 조건, 용도, 비용**을 한눈에 비교할 수 있어야 합니다. 이번 강의에서 모든 분해를 종합 정리합니다.

---

## 1. LU 분해

가우스 소거법(Gaussian elimination)을 행렬로 표현한 것입니다.

$$
A = LU
$$

- $L$: 하삼각 행렬 (대각 원소 1)
- $U$: 상삼각 행렬

### PLU 분해 (피벗팅)

실제로는 수치 안정성을 위해 행 교환(pivoting)이 필요합니다.

$$
PA = LU
$$

$P$는 치환 행렬(permutation matrix)입니다.

### 용도

$A\mathbf{x} = \mathbf{b}$를 풀 때, LU 분해 한 번 후 여러 $\mathbf{b}$에 대해 $O(n^2)$으로 풀 수 있습니다.

$$
L\mathbf{y} = P\mathbf{b} \quad \text{(전진 대입)}, \quad U\mathbf{x} = \mathbf{y} \quad \text{(후진 대입)}
$$

---

## 2. LDL$^T$ 분해

대칭 행렬에 대한 LU의 변형입니다.

$$
A = LDL^T
$$

- $L$: 하삼각 행렬 (대각 원소 1)
- $D$: 대각 행렬

Cholesky 분해와의 관계: $A$가 PD이면 $D$의 원소가 모두 양수이고, $A = LDL^T = (L\sqrt{D})(L\sqrt{D})^T$로 Cholesky와 연결됩니다.

LDL$^T$의 장점은 **제곱근 계산이 불필요**하다는 것입니다. PD가 아닌 대칭 행렬에도 적용 가능합니다.

---

## 3. Cholesky 분해 (복습)

대칭 양의 정부호(SPD) 행렬 전용입니다.

$$
A = LL^T
$$

LU의 약 **절반의 계산 비용**($n^3/6$ vs $n^3/3$)이며 피벗팅이 불필요합니다.

---

## 4. QR 분해 (복습)

임의의 행렬에 적용 가능합니다.

$$
A = QR
$$

최소제곱 문제에서 정규방정식보다 수치적으로 안정합니다.

---

## 5. 고유값 분해 (복습)

정방행렬, 대각화 가능할 때:

$$
A = PDP^{-1}
$$

대칭 행렬이면 직교 대각화:

$$
A = Q\Lambda Q^T
$$

---

## 6. SVD (복습)

**모든 행렬**에 적용 가능합니다.

$$
A = U\Sigma V^T
$$

가장 범용적이지만 계산 비용이 가장 높습니다.

---

## 7. Schur 분해

모든 정방행렬 $A \in \mathbb{R}^{n \times n}$에 대해,

$$
A = QTQ^T
$$

- $Q$: 직교(유니터리) 행렬
- $T$: 상삼각 행렬 (대각 원소가 고유값)

대각화가 불가능한 행렬에도 적용됩니다. 고유값 계산의 중간 단계로 사용됩니다.

$A$가 대칭이면 $T$도 대칭인데, 대칭인 상삼각 행렬은 대각 행렬입니다. 따라서 대칭 행렬의 Schur 분해 = 고유값 분해입니다.

---

## 8. Jordan 정규형 (개념)

대각화 불가능한 행렬의 "가장 단순한 형태"입니다.

$$
A = PJP^{-1}
$$

$J$는 Jordan 블록의 대각합입니다.

$$
J_k(\lambda) = \begin{pmatrix} \lambda & 1 & & \\ & \lambda & 1 & \\ & & \ddots & 1 \\ & & & \lambda \end{pmatrix}
$$

이론적으로 중요하지만, 수치적으로 **매우 불안정**하여 실전에서는 거의 사용하지 않습니다. Schur 분해가 대안입니다.

---

## 9. 종합 비교표

| 분해 | 적용 대상 | 조건 | 비용 | 주요 용도 |
|------|-----------|------|------|-----------|
| **LU** | 정방, 가역 | 없음 (피벗팅) | $O(n^3/3)$ | 선형 시스템, 행렬식 |
| **LDL$^T$** | 대칭 | 없음 | $O(n^3/6)$ | 대칭 시스템 |
| **Cholesky** | 대칭 PD | $A \succ 0$ | $O(n^3/6)$ | PD 시스템, 샘플링 |
| **QR** | 임의 | 없음 | $O(2mn^2/3)$ | 최소제곱, 고유값 |
| **고유값** | 정방 | 대각화 가능 | $O(n^3)$ | PCA, 안정성 분석 |
| **SVD** | 임의 | 없음 (항상 존재) | $O(mn\min(m,n))$ | 저랭크 근사, 의사역행렬 |
| **Schur** | 정방 | 없음 (항상 존재) | $O(n^3)$ | 고유값 계산, 행렬 함수 |
| **Jordan** | 정방 | 이론적 | 수치적 불안정 | 이론 분석만 |

---

## 10. 어떤 분해를 선택할 것인가

### 판단 플로우

1. **$A\mathbf{x} = \mathbf{b}$를 풀어야 한다**
   - $A$가 대칭 PD? → **Cholesky**
   - $A$가 대칭? → **LDL$^T$**
   - 일반 정방? → **LU (PLU)**
   - 과결정 ($m > n$)? → **QR** 또는 **SVD**

2. **고유값/고유벡터가 필요하다**
   - $A$가 대칭? → **`eigh`** (Schur 기반, 대칭 특화)
   - 일반 정방? → **`eig`** (Schur → 고유값 추출)

3. **저랭크 근사가 필요하다**
   - → **SVD** (정확) 또는 **랜덤화 SVD** (근사)

4. **행렬 함수 ($e^A$, $\log A$)를 계산해야 한다**
   - → **Schur 분해**

---

## 11. NumPy로 확인하기

```python
import numpy as np
from scipy import linalg

A = np.array([[4, 2, 1],
              [2, 5, 3],
              [1, 3, 6]], dtype=float)

# LU 분해
P, L, U = linalg.lu(A)
print("=== LU ===")
print(f"P @ L @ U = A? {np.allclose(P @ L @ U, A)}")

# LDL^T 분해
L_ldl, D_ldl, perm = linalg.ldl(A)
print("\n=== LDL^T ===")
print(f"L @ D @ L^T = A? {np.allclose(L_ldl @ D_ldl @ L_ldl.T, A)}")

# Cholesky
L_chol = np.linalg.cholesky(A)
print("\n=== Cholesky ===")
print(f"L @ L^T = A? {np.allclose(L_chol @ L_chol.T, A)}")

# QR
Q, R = np.linalg.qr(A)
print("\n=== QR ===")
print(f"Q @ R = A? {np.allclose(Q @ R, A)}")

# 고유값 분해
eigenvalues, Q_eig = np.linalg.eigh(A)
print("\n=== 고유값 분해 ===")
print(f"Q Λ Q^T = A? {np.allclose(Q_eig @ np.diag(eigenvalues) @ Q_eig.T, A)}")

# SVD
U, S, Vt = np.linalg.svd(A)
print("\n=== SVD ===")
print(f"U Σ V^T = A? {np.allclose(U @ np.diag(S) @ Vt, A)}")

# Schur 분해
T, Z = linalg.schur(A)
print("\n=== Schur ===")
print(f"Z T Z^T = A? {np.allclose(Z @ T @ Z.T, A)}")
print(f"T의 대각 (고유값): {np.diag(T).round(4)}")
```

---

## 핵심 정리

1. **LU**: 일반적인 선형 시스템의 기본 풀이. 피벗팅으로 수치 안정성 확보.
2. **Cholesky**: 대칭 PD 전용, LU의 절반 비용. 가우시안 샘플링에 필수.
3. **QR**: 최소제곱의 안정적 풀이. 정규방정식의 조건수 악화 없음.
4. **SVD**: 가장 범용적. 저랭크 근사, 의사역행렬, 네 부분 공간 모두 제공.
5. **실전 선택 기준**: 행렬의 성질(대칭? PD? 직사각형?)과 목적(시스템 풀이? 고유값? 저랭크?)에 따라 결정한다.
