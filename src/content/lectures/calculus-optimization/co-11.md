# KKT 조건

## 왜 KKT 조건을 배워야 하는가

co-10에서 등식 제약 최적화를 다뤘습니다. 하지만 현실의 제약은 대부분 **부등식** 형태입니다. "확률은 0 이상이어야 한다", "비용이 예산을 초과하면 안 된다", "마진이 1 이상이어야 한다(SVM)" 등이 그렇습니다.

**KKT 조건(Karush-Kuhn-Tucker conditions)**은 등식과 부등식 제약이 모두 있는 최적화 문제의 최적성 조건입니다. co-10의 라그랑주 승수법을 부등식 제약으로 확장한 것이며, 볼록 최적화에서는 필요충분조건이 됩니다.

---

## 1. 일반 제약 최적화 문제

$$
\min_{\mathbf{x}} f(\mathbf{x}) \quad \text{s.t.} \quad g_i(\mathbf{x}) \leq 0, \; i = 1, \dots, m, \quad h_j(\mathbf{x}) = 0, \; j = 1, \dots, p
$$

| 기호 | 의미 | 예시 |
|------|------|------|
| $f(\mathbf{x})$ | 목적 함수 | 손실 함수 |
| $g_i(\mathbf{x}) \leq 0$ | 부등식 제약 | $-x_i \leq 0$ (비음수) |
| $h_j(\mathbf{x}) = 0$ | 등식 제약 | $\sum p_i - 1 = 0$ |

---

## 2. 라그랑주 함수의 확장

$$
\mathcal{L}(\mathbf{x}, \boldsymbol{\mu}, \boldsymbol{\lambda}) = f(\mathbf{x}) + \sum_{i=1}^{m} \mu_i g_i(\mathbf{x}) + \sum_{j=1}^{p} \lambda_j h_j(\mathbf{x})
$$

부등식 제약의 승수 $\mu_i$에는 **비음수 조건** $\mu_i \geq 0$이 추가됩니다. 이것이 등식 제약($\lambda_j$는 부호 자유)과의 핵심 차이입니다.

---

## 3. KKT 조건

다음 네 가지 조건을 **KKT 조건**이라 합니다.

**(1) 정류 조건 (Stationarity)**:

$$
\nabla_\mathbf{x} \mathcal{L} = \nabla f + \sum_{i} \mu_i \nabla g_i + \sum_j \lambda_j \nabla h_j = \mathbf{0}
$$

**(2) 원시 타당성 (Primal Feasibility)**:

$$
g_i(\mathbf{x}) \leq 0, \quad h_j(\mathbf{x}) = 0
$$

**(3) 쌍대 타당성 (Dual Feasibility)**:

$$
\mu_i \geq 0
$$

**(4) 상보 슬랙니스 (Complementary Slackness)**:

$$
\mu_i g_i(\mathbf{x}) = 0, \quad \forall i
$$

> **핵심 직관**: 상보 슬랙니스는 "각 부등식 제약에 대해, 승수가 0이거나 제약이 등호로 활성화되거나 둘 중 하나"라는 뜻입니다. 즉, 비활성 제약($g_i < 0$)의 승수는 반드시 $\mu_i = 0$입니다.

---

## 4. 활성 제약과 비활성 제약

| 제약 상태 | 조건 | KKT 승수 | 의미 |
|----------|------|---------|------|
| **활성(active)** | $g_i(\mathbf{x}^*) = 0$ | $\mu_i \geq 0$ (자유) | 제약이 최적점을 "밀고 있음" |
| **비활성(inactive)** | $g_i(\mathbf{x}^*) < 0$ | $\mu_i = 0$ (강제) | 제약이 최적에 영향 없음 |

```
활성 vs 비활성 제약:

  │        g₁ = 0
  │       ╱
  │  x*· ╱     ← g₁ 활성 (μ₁ > 0)
  │     ╱
  │    ╱
  │   ╱
  │         g₂ = 0
  │               │
  │               │  ← g₂ 비활성 (μ₂ = 0)
  │               │    (x*에서 g₂ < 0)
  +──────────────→
```

---

## 5. 볼록 문제에서 KKT = 필요충분

**정리**: $f$, $g_i$가 볼록이고 $h_j$가 아핀이면 (제약 규칙성 조건 하에서):

$$
\mathbf{x}^* \text{가 최적} \iff \text{KKT 조건을 만족하는 } (\mathbf{x}^*, \boldsymbol{\mu}^*, \boldsymbol{\lambda}^*) \text{가 존재}
$$

비볼록 문제에서는 KKT가 필요조건일 뿐이지만, 볼록 문제에서는 **충분조건도** 됩니다. 이것이 볼록 최적화의 강력한 점입니다.

> **핵심 직관**: 볼록 문제에서 KKT 조건을 만족하는 점을 찾으면, 그것이 전역 최적임을 보장할 수 있습니다. co-15에서 다룰 SVM은 정확히 이 성질을 활용합니다.

---

## 6. 예제: 제약이 있는 이차 계획

$$
\min_{x, y} \; \frac{1}{2}(x^2 + y^2) \quad \text{s.t.} \quad x + y \geq 1
$$

표준형: $g(x, y) = 1 - x - y \leq 0$

KKT 조건:
- 정류: $x - \mu = 0$, $y - \mu = 0$
- 타당성: $1 - x - y \leq 0$, $\mu \geq 0$
- 상보 슬랙니스: $\mu(1 - x - y) = 0$

**경우 1**: $\mu = 0$ → $x = y = 0$ → $1 - 0 - 0 = 1 > 0$ 타당성 위반!

**경우 2**: $\mu > 0$ → $1 - x - y = 0$ → $x = y = \mu$, $2\mu = 1$ → $\mu = 1/2$, $x = y = 1/2$

```python
import numpy as np
from scipy.optimize import minimize

# scipy로 검증
result = minimize(
    lambda x: 0.5 * (x[0]**2 + x[1]**2),
    x0=[2.0, 2.0],
    constraints={'type': 'ineq', 'fun': lambda x: x[0] + x[1] - 1}
)

print(f"최적점: ({result.x[0]:.4f}, {result.x[1]:.4f})")
print(f"최적값: {result.fun:.4f}")
print(f"제약값 x+y-1 = {result.x[0] + result.x[1] - 1:.6f}")
```

출력:
```
최적점: (0.5000, 0.5000)
최적값: 0.2500
제약값 x+y-1 = 0.000000
```

---

## 7. SVM에서의 KKT 조건 미리보기

SVM(Support Vector Machine)은 KKT 조건의 대표적 응용입니다.

$$
\min_{\mathbf{w}, b} \frac{1}{2}\|\mathbf{w}\|^2 \quad \text{s.t.} \quad y_i(\mathbf{w}^\top \mathbf{x}_i + b) \geq 1
$$

KKT의 상보 슬랙니스에 의해:

$$
\mu_i \left[ y_i(\mathbf{w}^\top \mathbf{x}_i + b) - 1 \right] = 0
$$

- $\mu_i > 0$인 데이터: 제약 활성 → 마진 경계 위의 점 → **서포트 벡터**
- $\mu_i = 0$인 데이터: 제약 비활성 → 마진 안쪽 → 결정에 기여 안 함

> **핵심 직관**: SVM에서 "서포트 벡터"라는 이름은 KKT 조건에서 옵니다. 활성 제약에 대응하는 데이터만이 결정 경계를 "지탱(support)"합니다. co-15에서 자세히 다룹니다.

---

## 8. KKT 조건의 정리 다이어그램

```
  라그랑주 승수법 (co-10)        KKT 조건 (co-11)
  등식 제약만                    등식 + 부등식 제약
  ┌──────────────────┐          ┌──────────────────────┐
  │ ∇L = 0           │          │ (1) 정류 조건         │
  │ h(x) = 0         │  확장→   │ (2) 원시 타당성       │
  │ λ ∈ ℝ (자유)     │          │ (3) 쌍대 타당성 μ ≥ 0 │
  └──────────────────┘          │ (4) 상보 슬랙니스     │
                                └──────────────────────┘
```

---

## 핵심 정리

1. **KKT 조건**은 등식·부등식 제약이 있는 최적화의 최적성 조건이며, 정류·원시타당·쌍대타당·상보슬랙니스 4가지로 구성된다.
2. **상보 슬랙니스** $\mu_i g_i = 0$는 "비활성 제약의 승수는 0"이라는 핵심 조건이다.
3. **볼록 문제**에서 KKT 조건은 필요충분이므로, KKT를 만족하는 점이 곧 전역 최적이다.
4. **활성 제약**($g_i = 0$)만이 최적점을 결정하며, SVM의 서포트 벡터가 대표적 예시이다.
5. KKT 조건은 co-12(쌍대 이론)의 기초이며, 원시 문제와 쌍대 문제를 연결하는 다리 역할을 한다.
