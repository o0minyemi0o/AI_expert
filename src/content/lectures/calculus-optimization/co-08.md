# 볼록 집합과 볼록 함수

## 왜 볼록성을 배워야 하는가

최적화에서 가장 중요한 구분은 **볼록(convex) vs 비볼록(non-convex)** 입니다. 볼록 문제에서는 지역 최소점이 곧 전역 최소점이므로, 경사 하강법이 반드시 올바른 답에 도달합니다. 비볼록 문제(예: 신경망)에서는 이 보장이 없습니다.

SVM, 로지스틱 회귀, 릿지 회귀 등 고전적 ML 알고리즘의 손실 함수는 대부분 볼록입니다. 볼록성의 정의와 성질을 정확히 아는 것은 이런 알고리즘의 수렴 보장을 이해하는 열쇠입니다.

---

## 1. 볼록 집합의 정의

집합 $C \subseteq \mathbb{R}^n$이 **볼록(convex)**이란, 임의의 두 점을 잇는 선분이 $C$ 안에 포함되는 것입니다.

$$
\forall \mathbf{x}, \mathbf{y} \in C, \; \forall \theta \in [0, 1]: \quad \theta \mathbf{x} + (1-\theta)\mathbf{y} \in C
$$

```
볼록 집합         비볼록 집합

  ╭─────╮          ╭───╮
 │       │        │     ╲
 │  x·   │        │  x·  │
 │ ──── │        │ ─ ─  │ ← 선분이 밖으로 나감
 │   ·y  │        │    ·y│
  ╰─────╯          ╰──╯╱
```

**볼록 집합의 예시**:

| 집합 | 볼록? | 이유 |
|------|------|------|
| $\mathbb{R}^n$ | O | 전체 공간 |
| 초평면 $\{\mathbf{x} : \mathbf{a}^\top\mathbf{x} = b\}$ | O | 선형 |
| 반공간 $\{\mathbf{x} : \mathbf{a}^\top\mathbf{x} \leq b\}$ | O | 선형 부등식 |
| 다면체 (반공간의 교집합) | O | 볼록 집합의 교집합 |
| 구 $\{\mathbf{x} : \|\mathbf{x}\| \leq r\}$ | O | 노름 공 |
| 양정치 행렬 집합 $S^n_{++}$ | O | 원추(cone) |

> **핵심 직관**: 볼록 집합의 교집합은 항상 볼록입니다. 이것이 선형 부등식의 교집합인 다면체(polyhedron)가 볼록인 이유입니다.

---

## 2. 볼록 함수의 정의

$f : \mathbb{R}^n \to \mathbb{R}$이 **볼록(convex)**이란, 정의역이 볼록 집합이고:

$$
f(\theta \mathbf{x} + (1-\theta)\mathbf{y}) \leq \theta f(\mathbf{x}) + (1-\theta) f(\mathbf{y}), \quad \forall \theta \in [0, 1]
$$

기하학적으로, 두 점을 잇는 **현(chord)**이 함수 그래프 **위에** 있어야 합니다.

```
볼록 함수:                    비볼록 함수:

f(x)                         f(x)
  │    ·─────·  현 (위)        │     ╭╮
  │   ╱       ╲               │ ·──╱  ╲──·  현
  │  ╱   그래프 ╲              │  ╲╱    ╲╱
  │ ╱    (아래)  ╲             │   그래프가 현 위로
  │╱              ╲            │   튀어나옴
  +───────────────→ x         +──────────────→ x
```

---

## 3. 볼록 함수의 등가 정의들

$f$가 미분 가능한 경우, 세 가지 등가 조건이 있습니다.

**1차 조건 (접선 부등식)**:

$$
f(\mathbf{y}) \geq f(\mathbf{x}) + \nabla f(\mathbf{x})^\top (\mathbf{y} - \mathbf{x}), \quad \forall \mathbf{x}, \mathbf{y}
$$

이것은 "접선(접평면)이 함수 아래에 있다"는 조건입니다.

**2차 조건 (헤시안 조건)**:

$$
H(\mathbf{x}) \succeq 0 \quad (\text{양반정치}), \quad \forall \mathbf{x}
$$

co-03에서 배운 헤시안의 양정치/양반정치 판정이 여기서 직결됩니다.

| 조건 | 수학적 표현 | 기하학적 의미 |
|------|-----------|-------------|
| 0차 (정의) | $f(\theta x + (1-\theta)y) \leq \theta f(x) + (1-\theta)f(y)$ | 현이 그래프 위 |
| 1차 | $f(y) \geq f(x) + \nabla f(x)^\top(y-x)$ | 접선이 그래프 아래 |
| 2차 | $H(x) \succeq 0$ 모든 곳 | 곡률이 음이 아님 |

> **핵심 직관**: 볼록 함수의 1차 조건은 "어떤 점에서의 선형 근사는 항상 실제 함수값의 하한"이라는 뜻입니다. 이 성질 덕분에 경사 하강법이 올바른 방향을 보장합니다.

---

## 4. Jensen 부등식

볼록 함수의 정의를 확률적으로 확장한 것이 **Jensen 부등식**입니다.

$$
f(\mathbb{E}[\mathbf{X}]) \leq \mathbb{E}[f(\mathbf{X})]
$$

"함수의 기대값 ≥ 기대값의 함수" — 볼록 함수에서 항상 성립합니다.

ML에서의 응용:
- KL 발산의 비음수성 증명
- EM 알고리즘의 수렴 증명 (ELBO)
- 정보 이론의 기본 부등식들

---

## 5. 볼록 함수의 보존 연산

| 연산 | 조건 | 결과 |
|------|------|------|
| 비음수 가중합 | $\alpha f + \beta g$, $\alpha, \beta \geq 0$ | 볼록 |
| 합성 (아핀) | $f(\mathbf{Ax} + \mathbf{b})$ | 볼록 (입력이 아핀이면) |
| 점별 최대 | $\max(f_1, f_2, \dots)$ | 볼록 |
| 점별 상한 | $\sup_\alpha f_\alpha(\mathbf{x})$ | 볼록 |

```python
import numpy as np

# 볼록성 수치 검증: f(θx + (1-θ)y) ≤ θf(x) + (1-θ)f(y)?
def check_convexity(f, x, y, n_points=100):
    """두 점 사이에서 볼록성을 수치적으로 검증"""
    thetas = np.linspace(0, 1, n_points)
    violations = 0
    for theta in thetas:
        z = theta * x + (1 - theta) * y
        lhs = f(z)
        rhs = theta * f(x) + (1 - theta) * f(y)
        if lhs > rhs + 1e-10:
            violations += 1
    return violations == 0

# 볼록 함수 테스트
f_convex = lambda x: x[0]**2 + x[1]**2         # ‖x‖²
f_nonconvex = lambda x: np.sin(x[0]) + np.sin(x[1])

x = np.array([1.0, 2.0])
y = np.array([-1.0, 3.0])

print(f"f(x) = ‖x‖²:     볼록? {check_convexity(f_convex, x, y)}")
print(f"f(x) = sin(x)+sin(y): 볼록? {check_convexity(f_nonconvex, x, y)}")
```

출력:
```
f(x) = ‖x‖²:     볼록? True
f(x) = sin(x)+sin(y): 볼록? False
```

---

## 6. 지역 최소 = 전역 최소

볼록 함수의 가장 강력한 성질입니다.

**정리**: $f$가 볼록이면, 모든 지역 최소점은 **전역 최소점**이다.

**증명**: $\mathbf{x}^*$가 지역 최소이나 전역 최소가 아니라고 가정합니다. 즉, $f(\mathbf{y}) < f(\mathbf{x}^*)$인 $\mathbf{y}$가 존재합니다. 볼록성에 의해:

$$
f(\theta \mathbf{y} + (1-\theta)\mathbf{x}^*) \leq \theta f(\mathbf{y}) + (1-\theta) f(\mathbf{x}^*) < f(\mathbf{x}^*)
$$

$\theta$를 충분히 작게 잡으면, $\mathbf{x}^*$ 근방에서 더 작은 값이 존재하여 지역 최소에 모순입니다.

> **핵심 직관**: 볼록 함수에서 "내리막을 따라가면 반드시 전역 최적에 도달한다"가 보장됩니다. 이것이 볼록 최적화가 "쉬운" 이유이며, co-13에서 다룰 효율적 알고리즘의 이론적 기반입니다.

---

## 핵심 정리

1. **볼록 집합**은 임의의 두 점을 잇는 선분을 포함하는 집합이며, 교집합이 볼록성을 보존한다.
2. **볼록 함수**는 현이 그래프 위에 있는 함수이며, 1차(접선 부등식), 2차(헤시안 $\succeq 0$) 등가 조건으로 판별한다.
3. **Jensen 부등식** $f(\mathbb{E}[X]) \leq \mathbb{E}[f(X)]$는 볼록 함수의 확률적 확장이며, KL 발산 등에 응용된다.
4. 볼록 함수에서 **모든 지역 최소점은 전역 최소점**이며, 이것이 경사 하강법의 수렴 보장의 핵심이다.
5. 비음수 가중합, 아핀 합성, 점별 최대 등은 **볼록성을 보존**하는 연산이다.
