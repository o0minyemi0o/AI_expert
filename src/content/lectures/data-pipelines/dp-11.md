# 데이터 거버넌스

## 왜 데이터 거버넌스가 중요한가

데이터가 많아질수록 "이 데이터가 어디서 왔는지", "누가 접근할 수 있는지", "개인정보가 포함되어 있는지" 같은 질문이 중요해집니다. 파이프라인을 잘 만들어도 **거버넌스 없이는 데이터를 신뢰하고 안전하게 사용할 수 없습니다**. dp-06의 데이터 품질이 기술적 정확성이라면, 거버넌스는 조직적/법적 차원의 관리 체계입니다.

> **핵심 직관**: 데이터 거버넌스는 "데이터를 자산으로 관리하는 체계"입니다. 코드를 Git으로 관리하듯, 데이터도 **카탈로그, 리니지, 접근 제어, 컴플라이언스** 체계가 필요합니다.

## 1. 데이터 카탈로그

```
데이터 카탈로그란:
  조직 내 모든 데이터 자산의 검색 가능한 목록

  문제 (카탈로그 없이):
  "고객 LTV 데이터가 어디 있지?"
  → Slack에서 동료에게 물어보기
  → Wiki에서 검색 (대부분 outdated)
  → 결국 SQL 파일을 뒤지기

  카탈로그가 있으면:
  검색: "customer LTV"
  → fct_customer_ltv
     스키마: customer_id, ltv_30d, ltv_90d, ...
     소유자: 마케팅 데이터팀
     설명: 고객별 생애가치, 일일 배치 갱신
     최근 갱신: 2시간 전
     하류 사용: 추천 모델, 마케팅 대시보드

  주요 도구:
  ├─ DataHub (LinkedIn 오픈소스)
  ├─ OpenMetadata (오픈소스)
  ├─ Atlan (상용)
  └─ dbt docs (dbt 프로젝트 내)
```

```yaml
# dbt docs: schema.yml에서 카탈로그 정보 정의
models:
  - name: fct_customer_ltv
    description: |
      고객별 생애가치(LTV) 지표.
      일일 배치로 갱신되며, 30일/90일/전체 LTV를 포함.
    meta:
      owner: marketing-data
      pii: false
      sla: daily by 06:00 UTC
    columns:
      - name: customer_id
        description: 고객 고유 식별자
        tests: [unique, not_null]
      - name: ltv_90d
        description: 최근 90일간 총 구매액
```

## 2. 데이터 리니지

```
리니지 (Lineage):
  데이터의 출처부터 최종 사용까지의 흐름 추적

  [MySQL orders] → [CDC] → [Bronze: raw_orders]
                               ↓
                          [Silver: stg_orders]
                               ↓
                    ┌─────────────────────┐
                    ↓                     ↓
          [fct_orders]              [fct_customer_ltv]
               ↓                         ↓
        [매출 대시보드]              [추천 모델]

  리니지가 답하는 질문:
  ├─ 상류 (Upstream): "이 테이블은 어디서 왔는가?"
  │   fct_orders ← stg_orders ← raw_orders ← MySQL
  │
  ├─ 하류 (Downstream): "이 테이블을 누가 쓰는가?"
  │   raw_orders → stg_orders → fct_orders → 대시보드
  │
  └─ 영향 분석: "MySQL의 orders 스키마가 바뀌면 뭐가 깨지나?"
      → raw_orders → stg_orders → fct_orders → 대시보드


  dbt에서의 리니지:
  dbt docs generate → 자동 리니지 그래프 생성
  {{ ref('stg_orders') }}가 의존성 선언
```

> **핵심 직관**: 리니지의 가장 실용적인 용도는 **영향 분석(Impact Analysis)**입니다. "이 컬럼을 바꾸면 어떤 대시보드와 모델이 영향을 받는가?"를 즉시 파악할 수 있어야 안전하게 변경할 수 있습니다.

## 3. 접근 제어

```
데이터 접근 제어 계층:

  테이블 수준:
  └─ GRANT SELECT ON fct_orders TO analytics_role;

  행 수준 (Row-Level Security):
  └─ 한국팀은 region='kr' 데이터만 조회 가능
     CREATE POLICY korea_only ON orders
     FOR SELECT USING (region = current_setting('app.region'));

  컬럼 수준:
  └─ PII 컬럼 (이름, 이메일) 마스킹
     일반 사용자: email → 'a***@example.com'
     승인된 사용자: 원본 접근

  구현 패턴:
  ├─ RBAC (Role-Based Access Control)
  │   역할 기반: analyst, engineer, admin
  │
  ├─ ABAC (Attribute-Based Access Control)
  │   속성 기반: 부서=마케팅 AND 등급=시니어
  │
  └─ Tag-Based
      데이터 태그 기반: PII, Confidential, Public
```

## 4. PII와 컴플라이언스

```
PII (Personally Identifiable Information):

  직접 식별: 이름, 이메일, 전화번호, 주민등록번호
  간접 식별: 생년월일 + 성별 + 우편번호 → 개인 특정 가능

  처리 방법:
  ├─ 마스킹: '홍길동' → '홍**'
  ├─ 해싱: 'hong@mail.com' → 'a3f2e8...'
  ├─ 토큰화: 주민번호 → 'TKN_00123' (매핑 테이블 분리)
  ├─ 일반화: 30세 → '30대'
  └─ 삭제: 불필요한 PII는 수집하지 않음


규제 준수:

  GDPR (유럽):
  ├─ 잊힐 권리: 사용자 요청 시 개인 데이터 삭제
  ├─ 데이터 이동성: 사용자가 자신의 데이터 요청 가능
  └─ 동의 관리: 명시적 동의 필요

  PIPA (한국 개인정보보호법):
  ├─ 수집 목적 명시
  ├─ 목적 달성 후 파기
  └─ 제3자 제공 시 동의

  파이프라인에서의 구현:
  1. Bronze: PII 포함 (접근 제한)
  2. Silver: PII 마스킹/해싱 적용
  3. Gold: PII 완전 제거 또는 토큰화
  4. 삭제 요청: PII 매핑 테이블에서 삭제
     → 해시/토큰이 무효화 → 사실상 비식별화
```

> **핵심 직관**: GDPR의 "잊힐 권리"는 데이터 파이프라인에 큰 도전입니다. Parquet 파일에서 특정 행만 삭제하는 것은 비효율적이므로, **PII를 토큰으로 분리 관리**하여 토큰 매핑만 삭제하는 패턴이 실용적입니다.

## 5. 데이터 소유권

```
데이터 소유권 모델:

  중앙 집중 (Central Data Team):
  └─ 데이터 팀이 모든 데이터를 관리
     장점: 일관성, 표준화
     단점: 병목, 도메인 지식 부족

  데이터 메시 (Data Mesh):
  └─ 각 도메인 팀이 자신의 데이터를 "제품"으로 관리

     주문 도메인팀: orders 데이터 제품 소유
     결제 도메인팀: payments 데이터 제품 소유

     원칙:
     ├─ 도메인 소유권: 데이터를 만드는 팀이 관리
     ├─ 데이터를 제품으로: SLA, 문서, 품질 보장
     ├─ 셀프서비스 인프라: 플랫폼 팀이 도구 제공
     └─ 연합 거버넌스: 전체 표준은 공동 결정

  실무:
  └─ 대부분 하이브리드
     중앙 플랫폼 + 도메인별 데이터 소유
```

## 6. 거버넌스 체크리스트

```
데이터 거버넌스 성숙도 체크리스트:

  Level 1 (기본):
  ☐ 데이터 카탈로그 존재
  ☐ 주요 테이블에 소유자 지정
  ☐ PII 데이터 식별 및 분류

  Level 2 (관리):
  ☐ 리니지 자동 추적
  ☐ RBAC 접근 제어
  ☐ 데이터 품질 자동 검증 (dp-06)
  ☐ 스키마 변경 프로세스 (dp-07)

  Level 3 (최적화):
  ☐ 데이터 계약 운영
  ☐ 자동화된 PII 탐지/마스킹
  ☐ 데이터 메시 또는 도메인 소유권
  ☐ 컴플라이언스 자동 감사
```

데이터 거버넌스는 dp-06의 품질 관리, dp-07의 스키마 관리, dp-10의 피처 접근 제어를 조직 차원으로 통합합니다.

## 핵심 정리

- **데이터 카탈로그**는 조직 내 데이터 자산의 검색 가능한 목록이며, dbt docs가 가장 빠른 시작점입니다
- **리니지**는 데이터 출처~사용의 흐름을 추적하며, 영향 분석(Impact Analysis)이 가장 실용적인 용도입니다
- **접근 제어**는 테이블/행/컬럼 수준으로 세분화하며, PII 컬럼은 마스킹이 기본입니다
- **GDPR/PIPA** 준수를 위해 PII를 토큰으로 분리 관리하면 "삭제 요청"을 효율적으로 처리할 수 있습니다
- **데이터 메시**는 도메인 팀이 데이터를 제품으로 소유하는 모델이며, 중앙 플랫폼과의 하이브리드가 실무적입니다
